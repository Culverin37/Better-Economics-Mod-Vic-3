je_pec_rus_serfdom = {
	icon = "gfx/interface/icons/event_icons/event_scales.dds"

	group = je_group_internal_affairs

	is_shown_when_inactive = {
		c:RUS ?= this
		has_law = law_type:law_monarchy
	}

	possible = {
		has_technology_researched = egalitarianism
		global_country_ranking >= 2
		has_law = law_type:law_monarchy
		has_law = law_type:law_serfdom
		OR = {
			has_law = law_type:law_autocracy
			has_law = law_type:law_oligarchy
			has_law = law_type:law_single_party_state
			has_law = law_type:law_technocracy
		}
		ruler = {
			OR = {
				has_ideology = ideology:ideology_market_liberal
				has_ideology = ideology:ideology_abolitionist
				has_ideology = ideology:ideology_land_reformer
				has_ideology = ideology:ideology_distributist
				has_ideology = ideology:ideology_pec_liberal_nationalist
				has_ideology = ideology:ideology_pec_metallist
				has_ideology = ideology:ideology_pec_centralbanker
			}
		}
		hidden_trigger = {
			NOT = { has_variable = pec_completed_russerf }
		}
	}

	immediate = {
		hidden_effect = {
			set_variable = {
				name = pec_russerf_progress_var
				value = 0
			}
		}
		pec_set_russerf_vars = yes
		pec_calculate_russerf_progress = yes
		trigger_event = { id = pec_russerf.1 popup = yes }
		trigger_event = {
			id = pec_russerf.8
			days = 1
		}
	}

	on_weekly_pulse = {
		effect = {
			pec_calculate_russerf_progress = yes
		}
	}

	on_monthly_pulse = {
		random_events = {
			15 = 0
			3 = pec_russerf.4 # narodnik terrorism
			2 = pec_russerf.5 # priest arrives with grievances of serfs
			5 = pec_russerf.6 # milyutin's military reforms
			3 = pec_russerf.7 # create agrarian socialist agitator if there are none in russia
		}
		effect = {
			pec_add_russerf_progress = yes
		}
	}

	complete = {
		scope:journal_entry = {
			is_goal_complete = yes
		}
	}

	on_complete = {
		clear_russerf_vars = yes
		trigger_event = {
			id = pec_russerf.2 popup = yes
		}
		remove_modifier = pec_russian_serfdom_mod
		hidden_effect = {
			set_variable = pec_completed_russerf
		}
	}

	invalid = {
		OR = {
			NOT = { has_law = law_type:law_serfdom }
			NOT = { has_law = law_type:law_monarchy }
			AND = {
				NOT = { has_law = law_type:law_autocracy }
				NOT = { has_law = law_type:law_oligarchy }
				NOT = { has_law = law_type:law_single_party_state }
				NOT = { has_law = law_type:law_technocracy }
			}
		}
	}

	on_invalid = {
		clear_russerf_vars = yes
		remove_modifier = pec_russian_serfdom_mod
		hidden_effect = {
			set_variable = pec_completed_russerf
		}
	}

	fail = {
		trigger_if = {
			limit = {
				has_variable = pec_russerf_progress_var
			}
			custom_tooltip = {
				text = pec_russerf_je_fail
				root.var:pec_russerf_progress_var < 0
				has_variable = pec_russerf_initial_progress_set
			}
		}
	}

	on_fail = {
		clear_russerf_vars = yes
		trigger_event = {
			id = pec_russerf.3 popup = yes
		}
		remove_modifier = pec_russian_serfdom_mod
		set_variable = pec_completed_russerf
	}

	current_value = {
		value = root.var:pec_russerf_progress_var
	}

	goal_add_value = {
		add = 100
	}

	weight = 300

	progressbar = yes

	should_be_pinned_by_default = yes
}